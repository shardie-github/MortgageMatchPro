const { getDefaultConfig, mergeConfig } = require('@react-native/metro-config');

/**
 * Optimized Metro configuration for better performance
 * Generated by bundle optimization script
 */
const config = {
  resolver: {
    // Enable tree shaking
    unstable_enablePackageExports: true,
    // Optimize asset resolution
    assetExts: ['bin', 'txt', 'jpg', 'png', 'json', 'svg', 'ttf', 'otf', 'woff', 'woff2'],
    sourceExts: ['js', 'jsx', 'ts', 'tsx', 'json'],
  },
  transformer: {
    // Enable minification
    minifierConfig: {
      keep_fnames: true,
      mangle: {
        keep_fnames: true,
      },
    },
    // Enable hermes for better performance
    hermesParser: true,
    // Optimize for mobile
    getTransformOptions: async () => ({
      transform: {
        experimentalImportSupport: false,
        inlineRequires: true,
      },
    }),
  },
  serializer: {
    // Optimize bundle splitting
    createModuleIdFactory: function () {
      return function (path) {
        return path.replace(__dirname, '').replace(/[^a-zA-Z0-9]/g, '_').substring(0, 20);
      };
    },
    // Filter out unnecessary modules
    processModuleFilter: (module) => {
      return !module.path.includes('node_modules/react-native/Libraries/NewAppScreen');
    },
  },
  // Performance optimizations
  maxWorkers: Math.max(1, require('os').cpus().length - 1),
  resetCache: false,
};

module.exports = mergeConfig(getDefaultConfig(__dirname), config);
